To : 895237@bugs.debian.org
Subject : Bug#895237: apache2: apachectl does not use systemd for restarts
From : Jan HeitkÃ¶tter <jan@heitkoetter.net>
Date : Sun, 15 Apr 2018 21:50:57 +0200
Message-id : 1523821857.3190.4.camel@heitkoetter.net
Reply-to : Jan HeitkÃ¶tter <jan@heitkoetter.net>, 895237@bugs.debian.org
In-reply-to : <[ğŸ”]Â 1626229.q8V5VFdcH1@k>
References : <152320627314.25713.4008837136041031360.reportbug@wolke.in.heitkoetter.net>  <[ğŸ”]Â 20180412095603.GG28806@sym.noone.org> <[ğŸ”]Â 1626229.q8V5VFdcH1@k> <152320627314.25713.4008837136041031360.reportbug@wolke.in.heitkoetter.net>


Hallo Stefan,
Am Samstag, den 14.04.2018, 11:50 +0200 schrieb Stefan Fritsch:
> Using apachectl stop / start / restart works fine for me with
> systemd. TheÂ 
> issue is somewhere else.
This is what happens here:
root@wolke:/# systemctl status --no-pager apache2
â— apache2.service - The Apache HTTP Server
Â Â Â Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor
preset: enabled)
Â Â Â Active: active (running) since Sun 2018-04-15 21:42:42 CEST; 1s ago
Â  Process: 54785 ExecStop=/usr/sbin/apachectl stop (code=exited,
status=0/SUCCESS)
Â  Process: 52569 ExecReload=/usr/sbin/apachectl graceful (code=exited,
status=0/SUCCESS)
Â  Process: 54793 ExecStart=/usr/sbin/apachectl start (code=exited,
status=0/SUCCESS)
Â Main PID: 54797 (apache2)
Â Â Â CGroup: /system.slice/apache2.service
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54797 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54798 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54799 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54800 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54801 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â””â”€54802 /usr/sbin/apache2 -k start
Apr 15 21:42:42 wolke systemd[1]: Starting The Apache HTTP Server...
Apr 15 21:42:42 wolke systemd[1]: Started The Apache HTTP Server.
root@wolke:/# apachectl -k stop
root@wolke:/# apachectl -k start
root@wolke:/# systemctl status --no-pager apache2
â— apache2.service - The Apache HTTP Server
Â Â Â Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor
preset: enabled)
Â Â Â Active: inactive (dead) since Sun 2018-04-15 21:42:49 CEST; 6s ago
Â  Process: 54807 ExecStop=/usr/sbin/apachectl stop (code=exited,
status=0/SUCCESS)
Â  Process: 52569 ExecReload=/usr/sbin/apachectl graceful (code=exited,
status=0/SUCCESS)
Â  Process: 54793 ExecStart=/usr/sbin/apachectl start (code=exited,
status=0/SUCCESS)
Â Main PID: 54797 (code=exited, status=0/SUCCESS)
Apr 15 21:42:42 wolke systemd[1]: Starting The Apache HTTP Server...
Apr 15 21:42:42 wolke systemd[1]: Started The Apache HTTP Server.
Apr 15 21:42:49 wolke apachectl[54807]: httpd (no pid file) not running
The hooks in Letâ€™s Encryptâ€™s conffile say â€œapachectl -kâ€; the manpage
does not explain this option. Omitting -k makes things work:
root@wolke:/# systemctl status --no-pager apache2
â— apache2.service - The Apache HTTP Server
Â Â Â Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor
preset: enabled)
Â Â Â Active: active (running) since Sun 2018-04-15 21:46:49 CEST; 1s ago
Â  Process: 54831 ExecStop=/usr/sbin/apachectl stop (code=exited,
status=0/SUCCESS)
Â  Process: 52569 ExecReload=/usr/sbin/apachectl graceful (code=exited,
status=0/SUCCESS)
Â  Process: 54845 ExecStart=/usr/sbin/apachectl start (code=exited,
status=0/SUCCESS)
Â Main PID: 54849 (apache2)
Â Â Â CGroup: /system.slice/apache2.service
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54849 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54850 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54851 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54852 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54853 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â””â”€54854 /usr/sbin/apache2 -k start
Apr 15 21:46:49 wolke systemd[1]: Starting The Apache HTTP Server...
Apr 15 21:46:49 wolke systemd[1]: Started The Apache HTTP Server.
root@wolke:/# apachectl stop
root@wolke:/# apachectl start
Invoking 'systemctl start apache2'.
Use 'systemctl status apache2' for more info.
root@wolke:/# systemctl status --no-pager apache2
â— apache2.service - The Apache HTTP Server
Â Â Â Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor
preset: enabled)
Â Â Â Active: active (running) since Sun 2018-04-15 21:47:00 CEST; 2s ago
Â  Process: 54859 ExecStop=/usr/sbin/apachectl stop (code=exited,
status=0/SUCCESS)
Â  Process: 52569 ExecReload=/usr/sbin/apachectl graceful (code=exited,
status=0/SUCCESS)
Â  Process: 54870 ExecStart=/usr/sbin/apachectl start (code=exited,
status=0/SUCCESS)
Â Main PID: 54874 (apache2)
Â Â Â CGroup: /system.slice/apache2.service
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54874 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54875 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54876 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54877 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â”œâ”€54878 /usr/sbin/apache2 -k start
Â Â Â Â Â Â Â Â Â Â Â â””â”€54879 /usr/sbin/apache2 -k start
Apr 15 21:47:00 wolke systemd[1]: Starting The Apache HTTP Server...
Apr 15 21:47:00 wolke systemd[1]: Started The Apache HTTP Server.
For the time being I will remove -k from the hooks.
Regards
Jan